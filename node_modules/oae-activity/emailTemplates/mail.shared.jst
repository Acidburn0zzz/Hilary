<%

/**
 * Get an appropariate summary given a user's email preference and a set of activities
 * The options are:
 *     -   When an immediate email is sent with a single actor across all activities: <displayName> has been active recently
 *     -   When an immediate email is sent with multiple actors: New activity is waiting for you
 *     -   When a daily email is sent: Here's your summary of today's activity
 *     -   When a weekly email is sent: Here's your summary of last week's activity
 *
 * @return {String}                         An appropriate summary given the user's email preference and given activities
 */
var getEmailSummary = function() {
    if (user.emailPreference === 'immediate') {
        // Determine if there was a single or multiple actors
        var isSingleActor = true;
        var actor = null;
        _.each(activities, function(activity) {
            if (actor !== null && actor['oae:id'] !== activity.activity.actor['oae:id']) {
                isSingleActor = false;
            }
            actor = activity.activity.actor;
        });

        if (isSingleActor && actor.objectType !== 'collection') {
            var url = baseUrl + actor['oae:profilePath'];
            var key = 'ACTIVITY_EMAIL_SUMMARY_IMMEDIATE_SINGLE_ACTOR_SINGLE_ACTIVITY';
            if (activities.length > 1) {
                key = 'ACTIVITY_EMAIL_SUMMARY_IMMEDIATE_SINGLE_ACTOR_MULTIPLE_ACTIVITIES';
            }
            var summary = util.i18n.translate(key, {
                'actorURL': url,
                'actor': util.html.encodeForHTML(actor.displayName)
            });
            summary = util.html.ensureLinksStartWith(summary, baseUrl);
            return summary;
        } else {
            return '__MSG__ACTIVITY_EMAIL_SUMMARY_IMMEDIATE_MULTIPLE_ACTORS__';
        }
    } else if (user.emailPreference === 'daily') {
        return '__MSG__ACTIVITY_EMAIL_SUMMARY_DAILY__';
    } else if (user.emailPreference === 'weekly') {
        return '__MSG__ACTIVITY_EMAIL_SUMMARY_WEEKLY__';
    }
};

%>