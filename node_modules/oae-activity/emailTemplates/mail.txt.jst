<%
    var greeting = util.i18n.translate('__MSG__ACTIVITY_EMAIL_GREETING__', {'displayName': util.html.encodeForHTML(recipient.displayName)});
    greeting = util.html.toText(greeting, false);

    var summary = util.html.toText(shared.getEmailSummary(util, recipient.emailPreference, activities, baseUrl), false);
%>

<% if (recipient.displayName) { %>
    <%= greeting %>
<% } %>

<%= summary %>
<% _.each(activities, function(activity) { %>
    - <%= util.html.toText(util.url.ensureAbsoluteLinks(util.i18n.translate(activity.summary.i18nKey, activity.summary.i18nArguments), baseUrl), true) %><% }); %>

<%
var url = baseUrl + '/me?emailpreferences';
var footer = '';

footer += util.html.toText(util.url.ensureAbsoluteLinks(util.i18n.translate('__MSG__ACTIVITY_EMAIL_CHANGE_PREFRENCES__', {'url': url}), baseUrl), true) + '\n';

var footerMsg = '__MSG__POWERED_BY_APEREO_OAE__';
if (instance.name && hostingOrganization.name) {
    footerMsg = '__MSG__POWERED_BY_APEREO_OAE_INSTANCE_HOSTING_ORGANIZATION__';
} else if (instance.name) {
    footerMsg = '__MSG__POWERED_BY_APEREO_OAE_INSTANCE__';
} else if (hostingOrganization.name) {
    footerMsg = '__MSG__POWERED_BY_APEREO_OAE_HOSTING_ORGANIZATION__';
}

// Add the instance info to the footer
footer += util.i18n.translate(footerMsg, {
    'oaeLink': util.i18n.translate('__MSG__OPEN_ACADEMIC_ENVIRONMENT__'),
    'instanceLink': instance.name,
    'hostingOrganizationLink': hostingOrganization.name
});

print(footer);

%>
