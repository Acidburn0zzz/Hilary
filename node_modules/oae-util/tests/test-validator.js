/*
 * Copyright 2012 Sakai Foundation (SF) Licensed under the
 * Educational Community License, Version 2.0 (the "License"); you may
 * not use this file except in compliance with the License. You may
 * obtain a copy of the License at
 * 
 *     http://www.osedu.org/licenses/ECL-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an "AS IS"
 * BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing
 * permissions and limitations under the License.
 */

var User = require('oae-principals/lib/api.user').User;

var Validator = require('oae-util/lib/validator').Validator;

/**
 * 
 * @param {Object} test
 */
module.exports.testEmptyValidator = function(test) {
    test.expect(10);

    // Single test successful
    var validator = new Validator();
    validator.check('Non-empty string').notEmpty();
    test.ok(!validator.hasErrors());
    test.ok(!validator.getErrors());

    // Single test failed
    validator = new Validator();
    validator.check('').notEmpty();
    test.ok(validator.hasErrors());
    test.ok(validator.getErrors());

    validator = new Validator();
    validator.check(' ').notEmpty();
    test.ok(validator.hasErrors());
    test.ok(validator.getErrors());
    
    // Multiple success
    validator = new Validator();
    validator.check('Non').notEmpty();
    validator.check('Empty').notEmpty();
    validator.check('String').notEmpty();
    test.ok(!validator.hasErrors());
    test.ok(!validator.getErrors());

    // Multiple fail
    validator = new Validator();
    validator.check('').notEmpty();
    validator.check(' ').notEmpty();
    validator.check('   ').notEmpty();
    validator.check('String').notEmpty();
    test.ok(validator.hasErrors());
    test.equal(validator.getErrors().length, 3);

    test.done();
};

/**
 * 
 * @param {Object} test
 */
module.exports.testIntValidator = function(test) {
    test.expect(10);

    // Single test successful
    var validator = new Validator();
    validator.check(10).isInt();
    test.ok(!validator.hasErrors());
    test.ok(!validator.getErrors());

    validator = new Validator();
    validator.check('20').isInt();
    test.ok(!validator.hasErrors());
    test.ok(!validator.getErrors());

    // Single test failed
    validator = new Validator();
    validator.check('String').isInt();
    test.ok(validator.hasErrors());
    test.ok(validator.getErrors());
    
    // Multiple success
    validator = new Validator();
    validator.check(0).isInt();
    validator.check(1).isInt();
    validator.check(100).isInt();
    validator.check(-100).isInt();
    test.ok(!validator.hasErrors());
    test.ok(!validator.getErrors());

    // Multiple fail
    validator = new Validator();
    validator.check('').isInt();
    validator.check('10').isInt();
    validator.check('String').isInt();
    validator.check(100).isInt();
    test.ok(validator.hasErrors());
    test.equal(validator.getErrors().length, 2);

    test.done();
};

/**
 * 
 * @param {Object} test
 */
module.exports.testEmailValidator = function(test) {
    test.expect(10);

    // Single test successful
    var validator = new Validator();
    validator.check('nicolaas.matthijs@caret.cam.ac.uk').isEmail();
    test.ok(!validator.hasErrors());
    test.ok(!validator.getErrors());

    // Single test failed
    validator = new Validator();
    validator.check('nicolaas matthijs@caret.cam.ac.uk').isEmail();
    test.ok(validator.hasErrors());
    test.ok(validator.getErrors());
    
    validator = new Validator();
    validator.check('http://www.google.co.uk').isEmail();
    test.ok(validator.hasErrors());
    test.ok(validator.getErrors());
    
    // Multiple success
    validator = new Validator();
    validator.check('nicolaas.matthijs@caret.cam.ac.uk').isEmail();
    validator.check('bertpareyn@gmail.com').isEmail();
    validator.check('sfmorgan@btinternet.com').isEmail();
    validator.check('sally.phillips+unique_reference@gmail.com').isEmail();
    test.ok(!validator.hasErrors());
    test.ok(!validator.getErrors());

    // Multiple fail
    validator = new Validator();
    validator.check('').isEmail();
    validator.check('String').isEmail();
    validator.check('nicolaas matthijs@caret.cam.ac.uk').isEmail();
    validator.check('nicolaas.matthijs@caret.cam.ac.uk').isEmail();
    test.ok(validator.hasErrors());
    test.equal(validator.getErrors().length, 3);

    test.done();
};

/**
 * 
 * @param {Object} test
 */
module.exports.testUrlValidator = function(test) {
    test.expect(12);

    // Single test successful
    var validator = new Validator();
    validator.check('http://www.sakaiproject.org').isUrl();
    test.ok(!validator.hasErrors());
    test.ok(!validator.getErrors());

    validator = new Validator();
    validator.check('http://example.com/test.html').isUrl();
    test.ok(!validator.hasErrors());
    test.ok(!validator.getErrors());

    // Single test failed
    validator = new Validator();
    validator.check('String').isUrl();
    test.ok(validator.hasErrors());
    test.ok(validator.getErrors());
    
    validator = new Validator();
    validator.check('://www.google.co.uk').isUrl();
    test.ok(validator.hasErrors());
    test.ok(validator.getErrors());
    
    // Multiple success
    validator = new Validator();
    validator.check('https://oae-widgets.sakaiproject.org/sdk').isUrl();
    validator.check('http://support.google.com/docs/bin/answer.py?hl=en&answer=66343').isUrl();
    validator.check('http://www.w3.org/2004/02/skos/core#broader').isUrl();
    validator.check('https://wordpress.org/support/topic/plugin-addthis-odd-url-string?replies=5').isUrl();
    test.ok(!validator.hasErrors());
    test.ok(!validator.getErrors());

    // Multiple fail
    validator = new Validator();
    validator.check('').isUrl();
    validator.check('String').isUrl();
    validator.check('www.example.com').isUrl();
    validator.check('https://twimg0-a.akamaihd.net/profile_images/300425859/ls_1278_Nicolaas-website.jpg').isUrl();
    test.ok(validator.hasErrors());
    test.equal(validator.getErrors().length, 2);

    test.done();
};

// TODO
//module.exports.testUserValidator = function(test) {};
